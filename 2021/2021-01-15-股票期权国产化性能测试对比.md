## 背景

对比现有的性能机运行性能，按系统的准出标准分别对国产化机器与非国产化机器进行压力测试，并对比结果


## 机器配置

### 非国产x86架构性能机

组网交换机：Cisco 3548 / Arista 7150  万兆低延时交换机

| CPU型号                                              | 网卡                                                         | 内存 | 硬盘 | 操作系统                                             |
| ---------------------------------------------------- | ------------------------------------------------------------ | ---- | ---- | ---------------------------------------------------- |
| Intel(R) Xeon(R) Gold 6244 CPU @ 3.60GHz     2*8=16C | Solarflare  Communications Device 0b03 (rev 01)     onload-7.0.0.176 | 256G | 1T   | Red Hat Enterprise  Linux Server release 7.4 (Maipo) |



### 国产x86架构性能机

组网交换机：华为低时延交换机CE6881-48S6CQ-B

| CPU型号                                               | 网卡                                                         | 内存 | 硬盘 | 操作系统                                               |
| ----------------------------------------------------- | ------------------------------------------------------------ | ---- | ---- | ------------------------------------------------------ |
| Hygon C86 3188  8-core Processor@ 3.40GHz     2*8=16C | Mellanox Technologies MT27710 Family [ConnectX-4 Lx] (rev 01) | 256G | 1T   | NeoKylin Linux Advanced Server release V7.0 (Chromium) |

<font color="red">由于目前设备资源紧张，国产x86机器暂时使用Mellanox高性能网卡代替</font>

### 国产ARM架构性能机

组网交换机：华为低时延交换机CE6881-48S6CQ-B

| CPU型号                   | 网卡                        | 内存 | 硬盘 | 操作系统                                               |
| ------------------------- | --------------------------- | ---- | ---- | ------------------------------------------------------ |
| 华为鲲鹏处理器Kunpeng 920 | 华为Hi1822网卡芯片IN200网卡 | 256G | 1T   | NeoKylin Linux Advanced Server release V7.0 (Chromium) |





## 测试场景

**分别在上面三组机器上，测试以下场景的性能。**

### 一、单笔延时

客户端委托下达-->申报到交易所收到请求并处理请求完成的性能

**场景说明：(分别测试启用与不启用风控)**     

1. 采用单用户下达业务委托,时间间隔1000us,连续下达委托10000笔；    
2. 采用模拟成交工具模拟交易所；
3. 股票期权风控设置为每个单元6条风控； 
4. 请求:确认:成交=1:1:0.05;     
5. 基底委托量0;   

**测试分析：** 

1. api发起委托请求打点->api收到委托应答打点，可得到单笔委托的耗时
2. 核心收到委托请求打点->核心报盘申报后打点，可得到单笔委托在核心的处理耗时



### 二、吞吐量

启用报盘下单

**场景说明：**

| 操作员数 | 资金账户数 | 客户端连接数 | 发单间隔 | 总委托量 |
| -------- | ---------- | ------------ | -------- | -------- |
| 5        | 5          | 5            | 100us    | 1000W    |
| 5        | 5          | 5            | 50us     | 2000W    |

1、1个资金账户，模拟压力工具与核心会创建一个TCP连接；
2、开启4个工作线程。

**测试分析：**

1. 分析系统吞吐量



## 结果分析

对比国产化x86机器、国产化ARM机器、非国产化机器在相同场景下的不同表现，给出性能测试结论。

对比（*网络延时(网卡性能) = 单笔穿透耗时 - 核心穿透耗时*）可以大致得到网卡性能的差异

对比（*核心穿透耗时*）可以得到CPU性能的差异

| <span style="white-space:nowrap;">测试场景&emsp;</span>| 测试概要结果| 目标值|
| -- | -- | -- |
| 单笔延时     | 单账户，开启6条风控，开启模拟成交工具，基底委托量0，委托穿透平均时延时(api发出委托请求到api收到委托应答的耗时)：***XXX us*** <br />单账户，开启6条风控，开启模拟成交工具，基底委托量0，核心穿透平均时延时(核心收到委托请求到委托报盘的耗时)：***XXX us*** | 单笔穿透耗时<15us<br />核心穿透耗时<10us |
| 吞吐量  | 5个账户，开启6条风控，开启模拟成交工具，每个账户10000笔/秒下单，委托处理能力均值在***XXX***笔/秒左右；     <br />5个账户，开启6条风控，开启模拟成交工具，每个账户20000笔/秒下单，委托处理能力均值在***XXX***笔/秒左右； | 吞吐量>50000笔/s    |

